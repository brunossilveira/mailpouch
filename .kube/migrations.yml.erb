apiVersion: v1
kind: Pod
metadata:
  name: migrations-<%= deployment_id %>
  labels:
    purpose: rails-migrations
spec:
  restartPolicy: Never
  containers:
  - name: migrations
    image: us-central1-docker.pkg.dev/mailpouch-364912/mailpouch/mailpouch-gke:latest
    imagePullPolicy: IfNotPresent
    serviceAccountName: mailpouch-ksa
    command: ['bin/rails']
    args: ['db:setup']
    env:
    - name: RAILS_MASTER_KEY
      valueFrom:
        secretKeyRef:
          name: rails-master-key
          key: rails_master_key
    envFrom:
    - configMapRef:
        name: env
